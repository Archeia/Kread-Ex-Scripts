#:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=
#  ▼ Plane
#  Author: Kread-EX
#  Version 1.01carrots 
#  Release date: 08/01/2013
#:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=:=

#------------------------------------------------------------------------------
#  ▼ UPDATES
#------------------------------------------------------------------------------
# #  11/04/2013. Added compatibility with Yanfly's Parallax 
# #  01/15/2014. Allow scrolling parallax.
#------------------------------------------------------------------------------
#  ▼ TERMS OF USAGE
#------------------------------------------------------------------------------
# #  This modification is specific to Noise Waltz. 
# #  Feel free to use it, however, please do not distribute publicly.
#------------------------------------------------------------------------------
#  ▼ INTRODUCTION
#------------------------------------------------------------------------------
# # Rewrite the Plane class to work with Esrever's hacked DLL. Plug-and-play.
# # Carrots specific
#------------------------------------------------------------------------------

#==============================================================================
# ■ Plane
#==============================================================================

class Plane
  #--------------------------------------------------------------------------
  # ● Object initialize
  #--------------------------------------------------------------------------
  def initialize(view = nil)
    @viewport = view
    @sprite = Sprite.new(@viewport)
    @bm_w = 0
    @bm_h = 0
  end
  #--------------------------------------------------------------------------
  # ● Free
  #--------------------------------------------------------------------------
  def dispose
    @sprite.dispose
  end
  #--------------------------------------------------------------------------
  # ● Get freed
  #--------------------------------------------------------------------------
  def disposed?
    @sprite.disposed?
  end
  #--------------------------------------------------------------------------
  # ● Get visible
  #--------------------------------------------------------------------------
  def visible
    @sprite.visible
  end
  #--------------------------------------------------------------------------
  # ● Set visible
  #--------------------------------------------------------------------------
  def visible=(value)
    @sprite.visible = value
  end
  #--------------------------------------------------------------------------
  # ● Get zoom x
  #--------------------------------------------------------------------------
  def zoom_x
    @sprite.zoom_x
  end
  #--------------------------------------------------------------------------
  # ● Set zoom x
  #--------------------------------------------------------------------------
  def zoom_x=(value)
    @sprite.zoom_x = value
  end
  #--------------------------------------------------------------------------
  # ● Get zoom y
  #--------------------------------------------------------------------------
  def zoom_y
    @sprite.zoom_y
  end
  #--------------------------------------------------------------------------
  # ● Set zoom y
  #--------------------------------------------------------------------------
  def zoom_y=(value)
    @sprite.zoom_y = value
  end
  #--------------------------------------------------------------------------
  # ● Get opacity
  #--------------------------------------------------------------------------
  def opacity
    @sprite.opacity
  end
  #--------------------------------------------------------------------------
  # ● Set opacity
  #--------------------------------------------------------------------------
  def opacity=(value)
    @sprite.opacity = value
  end
  #--------------------------------------------------------------------------
  # ● Get blend type
  #--------------------------------------------------------------------------
  def blend_type
    @sprite.blend_type
  end
  #--------------------------------------------------------------------------
  # ● Set blend type
  #--------------------------------------------------------------------------
  def blend_type=(value)
    @sprite.blend_type = value
  end
  #--------------------------------------------------------------------------
  # ● Get color
  #--------------------------------------------------------------------------
  def color
    @sprite.color
  end
  #--------------------------------------------------------------------------
  # ● Set color
  #--------------------------------------------------------------------------
  def color=(value)
    @sprite.color = value
  end
  #--------------------------------------------------------------------------
  # ● Get tone
  #--------------------------------------------------------------------------
  def tone
    @sprite.tone
  end
  #--------------------------------------------------------------------------
  # ● Set tone
  #--------------------------------------------------------------------------
  def tone=(value)
    @sprite.tone = value
  end
  #--------------------------------------------------------------------------
  # ● Frame update
  #--------------------------------------------------------------------------
  def update
    @sprite.update
    if @sprite.x.abs % @bm_w == 0
      @sprite.x = 0
    end
    if @sprite.y.abs % @bm_h == 0
      @sprite.y = 0
    end
  end
  #--------------------------------------------------------------------------
  # ● Get viewport
  #--------------------------------------------------------------------------
  def viewport
    @viewport
  end
  #--------------------------------------------------------------------------
  # ● Set viewport
  #--------------------------------------------------------------------------
  def viewport=(value)
    @viewport = value
    @sprite.viewport = viewport
  end
  #--------------------------------------------------------------------------
  # ● Get bitmap
  #--------------------------------------------------------------------------
  def bitmap
    @sprite.bitmap
  end
  #--------------------------------------------------------------------------
  # ● Set bitmap
  #--------------------------------------------------------------------------
  def bitmap=(value)
    if value.nil?
      @sprite.bitmap = value
      return
    end
    bw = @viewport ? @viewport.rect.width : Graphics.width
    bh = @viewport ? @viewport.rect.height : Graphics.height
    if SceneManager.scene.is_a?(Scene_Map)# && $game_map.parallax_tile_lock?
      bw = $game_map.width * 32
      bh = $game_map.height * 32
    end
    bw *= 3
    bh *= 3
    rw = bw.fdiv(value.width).ceil
    rh = bh.fdiv(value.height).ceil
    new_bmp = Bitmap.new(bw, bh)
    0.upto(rw).each do |x|
      0.upto(rh).each do |y|
        new_bmp.blt(x * value.width, y * value.height, value, value.rect)
      end
    end
    @sprite.bitmap = new_bmp
    @bm_w = value.width
    @bm_h = value.height
    @sprite.ox = bw / 2
    @sprite.oy = bh / 2
  end
  #--------------------------------------------------------------------------
  # ● Get ox
  #--------------------------------------------------------------------------
  def ox
    @sprite.ox
  end
  #--------------------------------------------------------------------------
  # ● Set ox
  #--------------------------------------------------------------------------
  def ox=(nox)
    @sprite.ox = (nox % @bm_w)
  end
  #--------------------------------------------------------------------------
  # ● Get oy
  #--------------------------------------------------------------------------
  def oy
    @sprite.oy
  end
  #--------------------------------------------------------------------------
  # ● Set oy
  #--------------------------------------------------------------------------
  def oy=(noy)
    @sprite.oy = (noy % @bm_h)
  end
  #--------------------------------------------------------------------------
  # ● Get z
  #--------------------------------------------------------------------------
  def z
    @sprite.z
  end
  #--------------------------------------------------------------------------
  # ● Set z
  #--------------------------------------------------------------------------
  def z=(z)
    @sprite.z = z
  end
end